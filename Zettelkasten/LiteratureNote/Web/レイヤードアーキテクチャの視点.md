---
title: レイヤードアーキテクチャの視点
source: https://qiita.com/kichion/items/aca19765cb16e7e65946
author:
  - "[[kichion]]"
published: 2019-10-25
created: 2025-05-22
description: 「ValueObjectという考え方」でDDDの片鱗について書かせていただきました今回はDDD本のなかでも少し抽象度の高い「レイヤードアーキテクチャ」について深堀っていきますレイヤードアーキテク…
tags:
  - web
  - アーキテクチャ
---
![](https://relay-dsp.ad-m.asia/dmp/sync/bizmatrix?pid=c3ed207b574cf11376&d=x18o8hduaj&uid=3516551)

この記事は最終更新日から3年以上が経過しています。

「 [ValueObjectという考え方](https://qiita.com/kichion/items/151c6747f2f1a14305cc) 」でDDDの片鱗について書かせていただきました  
今回はDDD本のなかでも少し抽象度の高い「レイヤードアーキテクチャ」について深堀っていきます

## レイヤードアーキテクチャとは

レイヤーアーキテクチャ・レイヤードアーキテクチャと呼ばれているこのアーキテクチャ指向です  
DDDは特定技術へ依存しているわけではないのでDDD=レイヤードアーキテクチャ！とならないように気をつけましょう

上位互換の思想として以下のものがあります

- ヘキサゴナルアーキテクチャ
- オニオンアーキテクチャ
- クリーンアーキテクチャ

基本的にどのアーキテクチャも一貫して **責務を適切に設定して依存関係を明確にする** という目的があります

一番原始的（？）なレイヤードアーキテクチャはその名の通り  
責務を適切に設定した塊＝層（レイヤー）をイメージします

[![Untitled1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66063/648ce07f-b1bc-86b3-90fc-098920b2ce9a.png)](https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F66063%2F648ce07f-b1bc-86b3-90fc-098920b2ce9a.png?ixlib=rb-4.0.0&auto=format&gif-q=60&q=75&s=1b3910447aa4eaca2793eb88058e21b0)

これだけじゃなんのことやらって感じですね  
更に技術っぽい責務を割り振って **依存の方向** を一方方向にします

[![Untitled-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66063/af109d5b-744e-1be9-64b9-1d98b935ccc6.png)](https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F66063%2Faf109d5b-744e-1be9-64b9-1d98b935ccc6.png?ixlib=rb-4.0.0&auto=format&gif-q=60&q=75&s=48290342803f841b06fd1f3ef8e9c427)

これがレイヤードアーキテクチャの基本的なイメージ図です  
DDD本内ではもっとユビキタスな表現を使って以下のような層を定義しています

- UI層
- Application層
- Domain層
- Infrastructure層

### UI層

**表示における関心事** を取り扱う層です  
Webアプリケーションで扱うhttp requestやquery paramといった「表示に関するテクノロジー」はこの層から漏れ出ないようにします  
また、ドメインの情報を書き換えるといった操作はすべてApplication層を介して行い、直接ドメインオブジェクトに影響を与える操作はUI層で行わないようにします

### Application層

ユースケース毎に **ドメインオブジェクトのコーディネートの関心事** を取り扱う層です  
UI層からのリクエストに対してCRUD・ELTを行う層とも言えます  
依存関係からUI層のテクノロジーを認知しなくてもいいように実装されます  
また、ドメインの情報を書き換えるといった直接的な操作はドメインオブジェクトの振る舞いを介して行い、直接ドメインオブジェクトの値を変える操作はApplication層で行わないようにします  
DBなどの永続化への影響のある操作も行いません

### Domain層

**ビジネスルール・仕様の関心事** を取り扱う層です  
ここでようやくユースケースやユーザストーリーといったビジネスモデルの表現を行います  
ドメインの情報を書き換えるといった直接的な操作を行います  
UI層やApplication層の実装・テクノロジーを知らなくてもいいように実装されます

### Infrastructure層

**永続化テクノロジーの関心事** を取り扱う層です  
DB、メモリ操作といったテクノロジーに関する実装をこの層にまとめます  
また、ドメインオブジェクトに対してデータをパースしたりマッピングを行うこともします  
他の3層の実装を知らなくてもいいように実装されます

---

## レイヤードアーキテクチャの利点

ここまで見ているとなんだか複雑かつルールがややこしいように見えるだけですが  
大きな利点は **関心事の分離** にあります  
仮にUI層にスポットを当てて考えましょう

例） `Webアプリを作っていたあるプロダクト が Nativeアプリを作ろうとする`

大変そうですね  
しかし、レイヤードアーキテクチャを採用・実践できていれば追加実装はUI層にとどまります

[![Untitled-2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66063/077613a4-599a-ae20-ab97-9f4bc760db13.png)](https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F66063%2F077613a4-599a-ae20-ab97-9f4bc760db13.png?ixlib=rb-4.0.0&auto=format&gif-q=60&q=75&s=6d39436b7251d40e6323fc1b1e0f2ff9)

更に永続化で使用しているDBを変更したい事案が発生！

例） `MySqlとPostgre両方で使用したい！`

[![Untitled-3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/66063/d85e23fb-0746-d329-df32-e24834424876.png)](https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F66063%2Fd85e23fb-0746-d329-df32-e24834424876.png?ixlib=rb-4.0.0&auto=format&gif-q=60&q=75&s=7665bf3796bb67cc0dc6a22c163bda9c)

変更箇所は明確ですね  
コードの影響を調査する手間も減ります

（まぁ、現実問題は開発言語の問題やらetc... でココまでうまくいかないですが…）

このように層で整理されているので変更に対して強く、影響をイメージしやすくなります

---

## レイヤードアーキテクチャの弱点

上記で利点を述べましたが弱点もあります

- ストアドチックなコードより記述量は増える
- チーム開発で共通認識を作るのが大変
- ドメインロジックがテクノロジーの変更により影響を受ける

### ストアドチックなコードより記述量は増える

将来に渡り変更が軽微な場合や検証段階ではオーバーテクノロジーになりますね  
用法用量を守る必要があるのはアーキテクチャ採用の常なので意識する必要があります

### チーム開発で共通認識を作るのが大変

習熟度により差が生まれるのは設計・チーム開発のツラミでもあります…  
頑張って共通認識をつけるしかないですね（ぇ

### ドメインロジックがテクノロジーの変更により影響を受ける

依存方向を見ると明らかですね  
これは\*\*依存性の注入(DI)\*\*を利用することで解消できます  
DIについての詳細はまた別の機会に

---

いかがでしたか？アーキテクチャを意識していなかった方が興味を持つきっかけになれば幸いです  
実践できれば長期的に良い影響があり、ビジネス的な課題に寄り添っていけると思います

## その他

[軽量DDDでもやったほうがいい理由、けどやらない理由](https://qiita.com/kichion/items/b830ceffd08d3f6cfc9e)  
[ValueObjectという考え方](https://qiita.com/kichion/items/151c6747f2f1a14305cc)  
[Serviceクラスの意義と勘所](https://qiita.com/kichion/items/983e8330cd2651540d9c)  
[集約で境界を正しく表現する意味](https://qiita.com/kichion/items/3826277eb372826a313e)

[0](https://qiita.com/kichion/items/#comments)

コメント一覧へ移動

[202](https://qiita.com/kichion/items/aca19765cb16e7e65946/likers)

いいねしたユーザー一覧へ移動

155

ストックを更新しました